---
layout: article
title: Stress Testing Tool - Jmeter
tags: test stress-test jmeter
key: 2022-09-22-jmeter
---

## 简介
[Jmeter](https://github.com/apache/jmeter), 由apache开源的一个非常成熟的压测工具

## 安装
在mac上，直接用`homebrew`安装即可:
```shell
brew install jmeter
```

安装完成后，运行`jmeter`命令即可启动jmeter可视化操作界面

## 使用
### Test Plan
一个新建的jmeter脚本文件，最外层为test plan，可以添加如下组件:
- Threads: 添加测试用的线程组
- Config Element: 添加一些整体配置，如http请求头，dns缓存等
- Listener: 一系列监听结果的可视化，如result tree, summary report等，包含错误率、吞吐、时延等数据
- Timer: 一些计时器
- Pre Processer: 在执行之前的操作
- Post Processer: 在执行之后的操作
- Assertion: 断言

### Thread Group
一个执行的线程组，根据里面的配置可以实现并发请求:
  - Number of Threads(users): 模拟多个线程(用户)同时发起请求，即并发数
  - Ramp-up period(seconds): 启动时间
  - Loop Count: 选择循环次数
常用的往thread group中添加的组件:
  - Sampler
      - BeanShell Sampler: java脚本。例如:
      ```java
      // 通过脚本设置一个变量id，值为uuid
      import java.util.UUID;
      UUID uuid = UUID.randomUUID();
      vars.put("id",(uuid.toString()).toLowerCase().replaceAll("-","")); 
      ```
      - HTTP Request: 发送http请求 
  - Logic Controller: 添加一些逻辑操作，比如if-else，用来控制组件的执行流程

### HTTP Request
一个实际执行的请求，通常可以对他的入参出参进行一些配置
  - Config Element:
      - HTTP Header Manager: 处理请求头等参数
  - Pre Proccessors
      - User Parameters: 用户参数模板
  - Post Processors
      - JSON Extractor: HTTP返回包JSON字段解析

请求的数据也可以使用之前预先生成的变量，例如入参为:
```json
{
    "id": "${id}",
    "name": "test"
}
```